# 11-05-18

### Fetch API

웹 브라우저의 XMLHttpRequest 를 대체하기 위해 만들어진 새로운 HTTP client 표준이며, 비교적 최근에 도입되어 IE 및 구형 안드로이드 브라우저(4.x)는 지원하지 않는다.

최신 문법을 옛날 문법으로 바꿔주는 것이 트랜스파일러이다. 새로운 기능(최신 브라우저 기능)을 사용하고 싶으면 폴리필이라는 라이브러리를 사용해서 이용해야 한다.

#### Axios vs Fetch API

- Axios 는 여러 편의기능(instance 와 같이 설정을 재사용하거나 요청중인 연결을 취소하는 등)을 제공한다.
- 다만, Axios 는 내부적으로 XMLHttpRequest 를 사용하고 있는데 Service Worker 등의 최신 기술이 XMLHttpRequest 를 지원하지 않으므로, Service Worker 를 사용할 예정에 있는 프로젝트에서는 Axios 대신 Fetch API 를 사용해야만 한다.

---

### HTTP Cache

#### Cache

사전적 의미는 :

1. (무기 등의) 은닉처
2. 은닉하다

컴퓨터 분야에서의 캐시는 (주로 접근 속도의 개선을 위해) 데이터를 미리 복사해 놓는 임시 저장소, 혹은 그 임시 저장소에 데이터를 저장하는 행위를 가리킨다.
'cache' 혹은 'caching'이라는 용어 자체는 특정 기술을 가리키는 것이 아니라, 접근 속도를 개선하기 위해 따로 저장소를 두는 '방법'을 가리킨다.
컴퓨터의 아주 많은 부분(CPU, GPU, HDD, 네트워크, 웹, 데이터베이스...)에서 사용되고 있다.

#### HTTP Cache

- 자원의 효율적 로딩을 위한 웹 표준이다.
- 서버에서 가져온 자원(HTML, CSS, JS, 이미지, ...)을 가까운 곳(브라우저, 혹은 다른 서버)에 저장해놓고 재사용한다.
- 캐시를 할 것인지 말 것인지, 어떻게 할 것인지를 결정하는 규칙이 복잡하고, 브라우저마다 조금씩 다르다.

#### 캐시된 자원과 실제 자원의 내용이 달라지는 문제를 어떻게 해결할 것인가? - 원본의 업데이트로 인해 사본에 변경점이 구현되기 전까지

- Expiration (만료)
  정해진 시간이 지나면 캐시가 자동으로 삭제되도록 설정할 수 있다.
- Validation (검증)
  서버에 요청을 보내서 캐시를 계속 사용할 수 있는지 확인한다(변경점이 있는지를 서버에 물어보고 없다면 바로 사용, 있다면 업데이트 된 화면을 사용).

* 304 상태 코드 : 브라우저에 저장된 정보를 불러올 때의 코드.

#### Cache 관련 헤더

- Cache-Control
  (요청, 응답) 캐시와 관련된 다양한 기능을 하는 지시자를 포함. no-cache, max-age 가 많이 사용됨. no-cache, max-age=0 지시자는 캐시를 사용하지 않도록 하거나, 캐시를 아직도 쓸 수 있는지 검증하기 위해 사용된다. [각각의 자세한 의미](https://stackoverflow.com/questions/1046966/whats-the-difference-between-cache-control-max-age-0-and-no-cache)
- **ETag**
  (응답) 캐시의 검증을 위해 사용되는 자원의 식별자. 주로 자원의 [해시](https://namu.wiki/w/%ED%95%B4%EC%8B%9C)값이 사용되나, 마지막으로 수정된 시각, 혹은 버전 넘버를 사용하기도 한다.
- Expires
  (응답) 캐시를 만료시킬 시각을 서버에서 명시적으로 지정한다.

- Last-Modified
  (응답) 원래 자료가 마지막으로 수정된 시각이다.
- **If-None-Match**
  (요청) 검증을 위해 사용됨. 이전에 저장해두었던 자원의 ETag 값을 - If-None-Match 헤더의 값으로 요청에 포함시켜서 보내면, 서버는 해당 경로에 있는 자원의 ETag 와 비교해보고 자원의 전송 여부를 결정한다. 비교했을 때 변경되지 않았다면, `304 Not Modified` 상태가 나타난다. 바디에 자원을 포함시키면 안된다. 자원이 변경되었다면 바디를 포함해서 다시 새로운 정보를 전송할 것이기 때문에, `200 Ok`상태가 나타난다.
- If-Modified-Since
  (요청) 검증을 위해 사용됨. 이전에 저장해두었던 자원의 Last-Modified 값을 If-Modified-Since 헤더의 값으로 요청에 포함시켜서 보내면, 서버는 해당 경로에 있는 자원의 Last-Modified 와 비교해보고 자원의 전송 여부를 결정한다.

#### Cacheable Methods

POST 메소드는 Cacheable 범주에 포함되기는 하지만, 특별한 조건을 만족시켜야 하며 실무에서는 POST cache 가 거의 사용되지 않는다다.

#### 캐시의 사용

일단은 별다른 추가작업 없이도 편하게 캐시 기능을 사용할 수 있지만, 우리가 원하는대로 캐시가 동작하지 않을 때 그 원인을 파악하기 위해 캐시 관련 헤더는 숙지해두는 것이 좋다. 그리고 HTTP method 를 용도에 맞게 사용하는 것도 중요하다.

#### CDN

지료를 제공하기 위한 네트워크. 캐시를 이용한 저장소.

#### Hash

해시(hash)는 아래와 같은 특징을 갖고 있는 연산이다:

1. 같은 입력을 주면 항상 같은 출력이 나온다.
2. 입력이 조금이라도 달라지면 완전히 다른 출력이 나온다.

---

### GraphQL

#### REST API 의 단점

- (보통의 경우) 각각의 자원마다 경로가 따로 있다. 즉, 여러 자원이 동시에 필요한 경우에는 요청을 여러 번 보내야 한다 (요청의 횟수 면에서 비효율적).
- (보통의 경우) 자원의 필요한 속성만 얻어올 수 없다. 즉, 일부 속성이 필요하더라도 전체 속성을 가져와야만 한다 (요청의 용량 면에서 비효율적).

#### GraphQL

- Facebook 에서 2015 년 공개한 데이터 질의 언어
- REST API 를 대체하기 위해 만들어짐
- 클라이언트에서 필요한 데이터의 구조를 GraphQL 언어로 정의한 후 질의할 수 있고, 서버는 그에 맞게 구조화된 데이터를 응답
- 서버에서는 GraphQL 질의를 해석하기 위해 별도의 해석기가 필요하며, 여러 언어의 구현체가 나와있는 상태

[apollo graphQL](https://www.apollographql.com/client/)

[교재](https://fds11.github.io/fds-nodejs-http/)
---

### Template, DocumentFragment 실습

template tag안의 내용물은, 예를 들어, 이미지라 하더라도 다운받아지지 않는다.


---

개발할 때, 그려지는 것 먼저 확인하고 진행하자. 통신은 그 뒤에!
항상 그리는 코드부터 먼저 작성하는 것이 좋다.
  
